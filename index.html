<!DOCTYPE html>
<!-- Chosen Palette: Calm Neutrals -->
<!-- Application Structure Plan: –Ø —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–ª —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤ –≤–∏–¥–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –ø–∞–Ω–µ–ª–∏ (dashboard) —Å –¥–≤—É–º—è –∫–æ–ª–æ–Ω–∫–∞–º–∏, –∫–æ—Ç–æ—Ä–∞—è –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ –º–æ–±–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞. –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ü–∏–∫–ª–∞) –∏ –∫–∞—Ä—Ç–æ—á–∫—É —Å –æ–±–∑–æ—Ä–æ–º —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–∞–º–æ–π –≤–∞–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏. –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è –∏ –ø–∞–Ω–µ–ª—å —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ñ–∞–∑–µ. –¢–∞–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞–∑–¥–µ–ª—è–µ—Ç –±—ã—Å—Ç—Ä—ã–π –æ–±–∑–æ—Ä –∏ –≥–ª—É–±–æ–∫–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ, —á—Ç–æ —É–ª—É—á—à–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç, —Ç–∞–∫ –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ª–∏–±–æ –±—ã—Å—Ç—Ä–æ –ø–æ–ª—É—á–∏—Ç—å –Ω—É–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –ª–∏–±–æ –ø–æ–≥—Ä—É–∑–∏—Ç—å—Å—è –≤ –¥–µ—Ç–∞–ª–∏, –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. -->
<!-- Visualization & Content Choices: 
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ü–∏–∫–ª–∞ -> –¶–µ–ª—å: –í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö -> –ú–µ—Ç–æ–¥: –°—Ç–∏–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Ñ–æ—Ä–º–∞ -> –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ: –í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º -> –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∏ –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –ø–æ–Ω—è—Ç–Ω—ã–π —Å–ø–æ—Å–æ–± –¥–ª—è –≤–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö.
- –û–±–∑–æ—Ä —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è -> –¶–µ–ª—å: –ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ -> –ú–µ—Ç–æ–¥: –ö–∞—Ä—Ç–æ—á–∫–∞ —Å –∫–ª—é—á–µ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π (—Ñ–∞–∑–∞, –¥–µ–Ω—å —Ü–∏–∫–ª–∞) -> –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ: –ù–µ—Ç (—Ç–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ) -> –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ: –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–∞–º—É—é –≤–∞–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –Ω–∞ –≤–∏–¥–Ω–æ–º –º–µ—Å—Ç–µ.
- –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ —Ü–∏–∫–ª–∞ -> –¶–µ–ª—å: –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è, –ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ -> –ú–µ—Ç–æ–¥: –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ø–æ–ª–æ—Å–∞, —Å–æ–∑–¥–∞–Ω–Ω–∞—è —Å –ø–æ–º–æ—â—å—é HTML/CSS -> –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ: –ù–µ—Ç -> –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ: –î–∞—ë—Ç –Ω–∞–≥–ª—è–¥–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ –≤—Å—ë–º —Ü–∏–∫–ª–µ –∏ —Ç–µ–∫—É—â–µ–º –ø–æ–ª–æ–∂–µ–Ω–∏–∏ –≤ –Ω—ë–º.
- –ö–∞–ª–µ–Ω–¥–∞—Ä—å -> –¶–µ–ª—å: –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ -> –ú–µ—Ç–æ–¥: –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è —Å–µ—Ç–∫–∞ –¥–Ω–µ–π (HTML/CSS/JS) -> –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ: –ö–ª–∏–∫ –ø–æ –¥–Ω—é –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π, –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –º–µ—Å—è—Ü–∞–º -> –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ: –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –º–µ—Å—è—Ü–∞.
- –î–µ—Ç–∞–ª–∏ —Ñ–∞–∑—ã -> –¶–µ–ª—å: –ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ, –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ -> –ú–µ—Ç–æ–¥: –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç —Å –∏–∫–æ–Ω–∫–∞–º–∏ –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ -> –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ: –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –¥–µ–Ω—å -> –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –±–æ–ª—å—à–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –±–ª–æ–∫–∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∞–µ—Ç —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∏ –≤–æ—Å–ø—Ä–∏—è—Ç–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.
- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏/–ú–µ—Ç–æ–¥—ã: –¢–æ–ª—å–∫–æ Vanilla JS –∏ Tailwind CSS. Chart.js –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, —Ç–∞–∫ –∫–∞–∫ –Ω–µ—Ç —Å–ª–æ–∂–Ω—ã—Ö –¥–∏–∞–≥—Ä–∞–º–º.
-->
<!-- CONFIRMATION: NO SVG graphics used. NO Mermaid JS used. -->
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ñ–µ–Ω—Å–∫–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å ‚Äî –ü–∞–Ω–µ–ª—å —Ü–∏–∫–ª–∞</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #f5f3f1;
            --card-bg: #ffffff;
            --text-color: #3d352e;
            --text-muted: #8a7f77;
            --accent-color: #e1cbc1;
            --border-color: #e7e1dc;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.5s ease;
        }

        .card {
            background-color: var(--card-bg);
            border-color: var(--border-color);
            transition: background-color 0.5s ease, border-color 0.5s ease;
        }

        .themed-text { color: var(--text-color); }
        .themed-text-muted { color: var(--text-muted); }
        
        /* THEMES */
        body.theme-menstruation { --bg-color: #4a5568; --card-bg: #2d3748; --text-color: #e2e8f0; --text-muted: #a0aec0; --accent-color: #718096; --border-color: #4a5568; }
        body.theme-follicular { --bg-color: #e6fffa; --card-bg: #ffffff; --text-color: #234e52; --text-muted: #4a5568; --accent-color: #4fd1c5; --border-color: #bee3f8; }
        body.theme-ovulation { --bg-color: #fff5f5; --card-bg: #ffffff; --text-color: #9b2c2c; --text-muted: #c53030; --accent-color: #fc8181; --border-color: #fed7d7; }
        body.theme-luteal { --bg-color: #faf5ff; --card-bg: #ffffff; --text-color: #6b46c1; --text-muted: #805ad5; --accent-color: #b794f4; --border-color: #e9d8fd; }
        body.theme-pms { --bg-color: #f7fafc; --card-bg: #ffffff; --text-color: #4a5568; --text-muted: #718096; --accent-color: #a0aec0; --border-color: #e2e8f0; }

        .day-cell { transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .day-cell:hover { transform: translateY(-3px); box-shadow: 0 4px 12px rgba(0,0,0,0.08); }

        .day-menstruation { background-color: #718096; color: white; }
        .day-follicular { background-color: #81e6d9; color: #234e52; }
        .day-ovulation { background-color: #fc8181; color: white; }
        .day-luteal { background-color: #b794f4; color: white; }
        .day-pms { background-color: #a0aec0; color: white; }
    </style>
</head>
<body class="p-4 sm:p-6 lg:p-8">

    <div class="max-w-7xl mx-auto">
        <header class="mb-8">
            <h1 class="text-3xl font-bold themed-text">–ü–∞–Ω–µ–ª—å –∂–µ–Ω—Å–∫–æ–≥–æ —Ü–∏–∫–ª–∞</h1>
            <p class="themed-text-muted mt-1">–ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å–≤–æ–π —Ü–∏–∫–ª –∏ –∂–∏–≤–∏—Ç–µ –≤ –≥–∞—Ä–º–æ–Ω–∏–∏ —Å –µ–≥–æ —Ñ–∞–∑–∞–º–∏.</p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 xl:grid-cols-4 gap-6">

            <!-- Left Column -->
            <aside class="lg:col-span-1 xl:col-span-1 flex flex-col gap-6">
                <!-- Today's Summary -->
                <section id="today-summary-card" class="card border rounded-2xl p-6">
                    <h2 class="text-sm font-semibold uppercase tracking-wider themed-text-muted">–°–µ–≥–æ–¥–Ω—è</h2>
                    <p id="today-date" class="text-xl font-bold themed-text"></p>
                    <div class="mt-4">
                        <p class="text-4xl font-bold" style="color: var(--accent-color);" id="today-phase-name">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                        <p class="themed-text-muted"><span id="today-cycle-day">--</span> –¥–µ–Ω—å —Ü–∏–∫–ª–∞</p>
                    </div>
                </section>
                
                <!-- Cycle Visualization -->
                <section class="card border rounded-2xl p-6">
                     <h2 class="text-sm font-semibold uppercase tracking-wider themed-text-muted mb-4">–í–∞—à —Ü–∏–∫–ª</h2>
                     <div id="cycle-timeline" class="w-full flex rounded-full h-3 overflow-hidden"></div>
                     <div id="cycle-legend" class="text-xs mt-3 grid grid-cols-2 gap-x-4 gap-y-1"></div>
                </section>

                <!-- Settings -->
                <section class="card border rounded-2xl p-6">
                    <h2 class="text-lg font-bold themed-text mb-4">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ü–∏–∫–ª–∞</h2>
                    <div class="space-y-4">
                        <div>
                            <label for="startDate" class="block text-sm font-medium themed-text-muted">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ü–∏–∫–ª–∞</label>
                            <input id="startDate" type="date" class="mt-1 block w-full bg-transparent border rounded-md p-2 themed-text border-gray-600/20">
                        </div>
                        <div>
                            <label for="cycleLength" class="block text-sm font-medium themed-text-muted">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ü–∏–∫–ª–∞ (–¥–Ω–µ–π)</label>
                            <input id="cycleLength" type="number" min="20" max="45" value="28" class="mt-1 block w-full bg-transparent border rounded-md p-2 themed-text border-gray-600/20">
                        </div>
                        <div>
                            <label for="periodLength" class="block text-sm font-medium themed-text-muted">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–µ–Ω—Å—Ç—Ä—É–∞—Ü–∏–∏ (–¥–Ω–µ–π)</label>
                            <input id="periodLength" type="number" min="1" max="10" value="5" class="mt-1 block w-full bg-transparent border rounded-md p-2 themed-text border-gray-600/20">
                        </div>
                    </div>
                    <button id="saveSettingsBtn" class="mt-6 w-full py-2 px-4 rounded-md bg-zinc-700 text-white font-semibold hover:bg-zinc-800 transition">
                        –°–æ—Ö—Ä–∞–Ω–∏—Ç—å
                    </button>
                </section>
            </aside>

            <!-- Right Column -->
            <div class="lg:col-span-2 xl:col-span-3 flex flex-col gap-6">
                <!-- Calendar -->
                <section class="card border rounded-2xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 id="monthTitle" class="text-xl font-bold themed-text"></h2>
                        <div class="flex items-center gap-2">
                            <button id="prevMonth" class="p-2 rounded-md hover:bg-black/5 themed-text-muted">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                            </button>
                            <button id="nextMonth" class="p-2 rounded-md hover:bg-black/5 themed-text-muted">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg>
                            </button>
                        </div>
                    </div>
                    <div id="calendarGrid" class="grid grid-cols-7 gap-1 text-center"></div>
                </section>
                
                <!-- Phase Details -->
                <section id="info-panel" class="card border rounded-2xl p-6">
                     <div id="info-content">
                        <h2 class="text-xl font-bold themed-text" id="selected-date-title">–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–Ω—å –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ</h2>
                        <p class="themed-text-muted" id="selected-phase-name">–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–∑–µ —Ü–∏–∫–ª–∞.</p>
                        <div id="recommendations" class="mt-4 space-y-4"></div>
                     </div>
                </section>
            </div>
        </main>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // –ö–æ–Ω—Å—Ç–∞–Ω—Ç–∞ –¥–ª—è –Ω–µ–∏–∑–º–µ–Ω—è–µ–º–æ–π –¥–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç–∏ –ü–ú–°, —Ç–∞–∫ –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –≤–≤–æ–¥ –±—ã–ª —É–¥–∞–ª–µ–Ω
    const PMS_LENGTH = 6;
    
    const PHASES = {
        menstruation: {
            name: '–ú–µ–Ω—Å—Ç—Ä—É–∞—Ü–∏—è',
            theme: 'theme-menstruation',
            color: '#718096',
            data: {
                "üåÄ –ì–æ—Ä–º–æ–Ω—ã": "–£—Ä–æ–≤–µ–Ω—å —ç—Å—Ç—Ä–æ–≥–µ–Ω–∞ –∏ –ø—Ä–æ–≥–µ—Å—Ç–µ—Ä–æ–Ω–∞ –Ω–∏–∑–∫–∏–π.",
                "‚ù§Ô∏è –°–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ": "–£—Å—Ç–∞–ª–æ—Å—Ç—å, –∏–Ω—Ç—Ä–æ–≤–µ—Ä—Å–∏—è, –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ —É–µ–¥–∏–Ω–µ–Ω–∏–∏. –ü–æ–≤—ã—à–µ–Ω–Ω–∞—è –∏–Ω—Ç—É–∏—Ü–∏—è.",
                "üìã –ó–∞–¥–∞—á–∏": "–û—Ç–¥—ã—Ö, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ, –ª—ë–≥–∫–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø–æ–¥–≤–µ–¥–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤.",
                "‚ú® –†–∏—Ç—É–∞–ª—ã": "–ú–µ–¥–∏—Ç–∞—Ü–∏—è –≤ —Ç–∏—à–∏–Ω–µ, —Å–ø–∞, –≤–µ–¥–µ–Ω–∏–µ –¥–Ω–µ–≤–Ω–∏–∫–∞.",
                "üèÉ‚Äç‚ôÄÔ∏è –î–≤–∏–∂–µ–Ω–∏–µ": "–†–∞—Å—Å–ª–∞–±–ª—è—é—â–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏, —Ä–∞—Å—Ç—è–∂–∫–∞, –ø–∞—Å—Å–∏–≤–Ω—ã–µ –ø–æ–∑—ã –π–æ–≥–∏.",
                "ü•ó –ü–∏—Ç–∞–Ω–∏–µ": "–¢—ë–ø–ª–∞—è –∏ –º—è–≥–∫–∞—è –ø–∏—â–∞: –∫–∞—à–∏, —Å—É–ø—ã, —Ç—É—à—ë–Ω—ã–µ –æ–≤–æ—â–∏, –Ω–µ–∂–∏—Ä–Ω—ã–π –±–µ–ª–æ–∫.",
            }
        },
        follicular: {
            name: '–§–æ–ª–ª–∏–∫—É–ª—è—Ä–Ω–∞—è',
            theme: 'theme-follicular',
            color: '#81e6d9',
            data: {
                "üåÄ –ì–æ—Ä–º–æ–Ω—ã": "–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π —Ä–æ—Å—Ç —ç—Å—Ç—Ä–æ–≥–µ–Ω–∞.",
                "‚ù§Ô∏è –°–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ": "–ü—Ä–∏–ª–∏–≤ —ç–Ω–µ—Ä–≥–∏–∏, –ª—ë–≥–∫–æ—Å—Ç—å, —è—Å–Ω–æ—Å—Ç—å —É–º–∞, —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, —Å–æ—Ü–∏–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å.",
                "üìã –ó–∞–¥–∞—á–∏": "–ù–æ–≤—ã–µ –Ω–∞—á–∏–Ω–∞–Ω–∏—è, –∞–∫—Ç–∏–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è, —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ, –º–æ–∑–≥–æ–≤—ã–µ —à—Ç—É—Ä–º—ã.",
                "‚ú® –†–∏—Ç—É–∞–ª—ã": "–õ—ë–≥–∫–∞—è —É—Ç—Ä–µ–Ω–Ω—è—è —Ä–∞–∑–º–∏–Ω–∫–∞, —Ç–∞–Ω–µ—Ü, –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏–π –Ω–∞ —Ü–∏–∫–ª.",
                "üèÉ‚Äç‚ôÄÔ∏è –î–≤–∏–∂–µ–Ω–∏–µ": "–î–∏–Ω–∞–º–∏—á–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏, –∫–∞—Ä–¥–∏–æ, —Ç–∞–Ω—Ü—ã.",
                "ü•ó –ü–∏—Ç–∞–Ω–∏–µ": "–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ: –±–µ–ª–∫–∏, —Å–ª–æ–∂–Ω—ã–µ —É–≥–ª–µ–≤–æ–¥—ã, —Å–≤–µ–∂–∏–µ –æ–≤–æ—â–∏ –∏ —Ñ—Ä—É–∫—Ç—ã.",
            }
        },
        ovulation: {
            name: '–û–≤—É–ª—è—Ü–∏—è',
            theme: 'theme-ovulation',
            color: '#fc8181',
            data: {
                "üåÄ –ì–æ—Ä–º–æ–Ω—ã": "–ü–∏–∫ –ª—é—Ç–µ–∏–Ω–∏–∑–∏—Ä—É—é—â–µ–≥–æ –≥–æ—Ä–º–æ–Ω–∞ (–õ–ì) –∏ —ç—Å—Ç—Ä–æ–≥–µ–Ω–∞.",
                "‚ù§Ô∏è –°–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ": "–ú–∞–∫—Å–∏–º—É–º —ç–Ω–µ—Ä–≥–∏–∏, –≤—ã—Å–æ–∫–∞—è —Å–µ–∫—Å—É–∞–ª—å–Ω–æ—Å—Ç—å, –º–∞–≥–Ω–µ—Ç–∏–∑–º, –∂–µ–Ω—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å.",
                "üìã –ó–∞–¥–∞—á–∏": "–°–æ—Ü–∏–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è, —Å–≤–∏–¥–∞–Ω–∏—è, —Ç–≤–æ—Ä—á–µ—Å–∫–∏–µ –ø—Ä–æ–µ–∫—Ç—ã.",
                "‚ú® –†–∏—Ç—É–∞–ª—ã": "–î—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏, –∞—Ñ—Ñ–∏—Ä–º–∞—Ü–∏–∏ –Ω–∞ –ø—Ä–æ—è–≤–ª–µ–Ω–∏–µ –∂–µ–Ω—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏.",
                "üèÉ‚Äç‚ôÄÔ∏è –î–≤–∏–∂–µ–Ω–∏–µ": "–†–∞—Å–∫—Ä—ã–≤–∞—é—â–∏–µ –∂–µ—Å—Ç—ã, –∫—Ä—É–≥–æ–≤—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è, –π–æ–≥–∞ –¥–ª—è —Ä–∞—Å–∫—Ä—ã—Ç–∏—è —Ç–∞–∑–∞.",
                "ü•ó –ü–∏—Ç–∞–Ω–∏–µ": "–õ—ë–≥–∫–∞—è –ø–∏—â–∞: —Å–∞–ª–∞—Ç—ã, —Å–º—É–∑–∏, –∫–∏–Ω–æ–∞, –º–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç—ã.",
            }
        },
        luteal: {
            name: '–õ—é—Ç–µ–∏–Ω–æ–≤–∞—è',
            theme: 'theme-luteal',
            color: '#b794f4',
            data: {
                "üåÄ –ì–æ—Ä–º–æ–Ω—ã": "–í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–≥–µ—Å—Ç–µ—Ä–æ–Ω–∞.",
                "‚ù§Ô∏è –°–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ": "–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, –∑–∞—Ç–µ–º –≤–æ–∑–º–æ–∂–Ω–∞ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å, –∏–Ω—Ç—É–∏—Ü–∏—è, —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å.",
                "üìã –ó–∞–¥–∞—á–∏": "–ó–∞–±–æ—Ç–∞ –æ —Å–µ–±–µ –∏ –¥–æ–º–µ, –≤–µ–¥–µ–Ω–∏–µ –¥–Ω–µ–≤–Ω–∏–∫–∞, —Å–ø–æ–∫–æ–π–Ω—ã–µ –∏ —Ä—É—Ç–∏–Ω–Ω—ã–µ –¥–µ–ª–∞.",
                "‚ú® –†–∏—Ç—É–∞–ª—ã": "–ú–µ–¥–∏—Ç–∞—Ü–∏–∏ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏, —Ç—ë–ø–ª—ã–π —á–∞–π, —É—é—Ç–Ω—ã–µ –≤–µ—á–µ—Ä–∞.",
                "üèÉ‚Äç‚ôÄÔ∏è –î–≤–∏–∂–µ–Ω–∏–µ": "–ü–ª–∞–≤–Ω—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è, —Å–∞–º–æ–º–∞—Å—Å–∞–∂, —Å–ø–æ–∫–æ–π–Ω–∞—è –π–æ–≥–∞.",
                "ü•ó –ü–∏—Ç–∞–Ω–∏–µ": "–ü–∏—Ç–∞—Ç–µ–ª—å–Ω–∞—è –∏ –º—è–≥–∫–∞—è –ø–∏—â–∞: —Å—É–ø—ã-–ø—é—Ä–µ, –∫–∞—à–∏, –∑–∞–ø–µ—á—ë–Ω–Ω—ã–µ –æ–≤–æ—â–∏.",
            }
        },
        pms: {
            name: '–ü–ú–°',
            theme: 'theme-pms',
            color: '#a0aec0',
            data: {
                "üåÄ –ì–æ—Ä–º–æ–Ω—ã": "–°–Ω–∏–∂–µ–Ω–∏–µ —ç—Å—Ç—Ä–æ–≥–µ–Ω–∞ –∏ –ø—Ä–æ–≥–µ—Å—Ç–µ—Ä–æ–Ω–∞.",
                "‚ù§Ô∏è –°–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ": "–°–æ–Ω–ª–∏–≤–æ—Å—Ç—å, —Ä–∞–∑–¥—Ä–∞–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –≥—Ä—É—Å—Ç—å, –Ω–æ—Å—Ç–∞–ª—å–≥–∏—è.",
                "üìã –ó–∞–¥–∞—á–∏": "–ú–∏–Ω–∏–º—É–º –¥–µ–ª, —Å–±–æ—Ä —ç–Ω–µ—Ä–≥–∏–∏, –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –º–µ–Ω—Å—Ç—Ä—É–∞—Ü–∏–∏.",
                "‚ú® –†–∏—Ç—É–∞–ª—ã": "–£–∫—É—Ç–∞—Ç—å—Å—è –≤ –ø–ª–µ–¥, —Ç—ë–ø–ª—ã–π –Ω–∞–ø–∏—Ç–æ–∫, –æ—á–∏—â–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞.",
                "üèÉ‚Äç‚ôÄÔ∏è –î–≤–∏–∂–µ–Ω–∏–µ": "–õ—ë–∂–∞-–π–æ–≥–∞, –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –¥–ª—è —É—Å–ø–æ–∫–æ–µ–Ω–∏—è.",
                "ü•ó –ü–∏—Ç–∞–Ω–∏–µ": "–¢—ë–ø–ª–æ–µ –∏ –æ–±–≤–æ–ª–∞–∫–∏–≤–∞—é—â–µ–µ: –∫—Ä–µ–º-—Å—É–ø—ã, –∑–∞–ø–µ—á—ë–Ω–Ω—ã–µ —è–±–ª–æ–∫–∏, –±–∞–Ω–∞–Ω—ã.",
            }
        }
    };

    const STORAGE_KEY = 'femaleCycleDashboardSettings';
    let viewDate = new Date();
    viewDate.setDate(1);

    const defaultSettings = {
        lastPeriodStart: new Date(new Date().setDate(new Date().getDate() - 10)).toISOString().slice(0, 10),
        cycleLength: 28,
        periodLength: 5
    };

    let settings = JSON.parse(localStorage.getItem(STORAGE_KEY)) || defaultSettings;

    function saveSettings() {
        const startDateEl = document.getElementById('startDate');
        const cycleLengthEl = document.getElementById('cycleLength');
        const periodLengthEl = document.getElementById('periodLength');

        settings.lastPeriodStart = startDateEl.value;
        settings.cycleLength = parseInt(cycleLengthEl.value);
        settings.periodLength = parseInt(periodLengthEl.value);

        localStorage.setItem(STORAGE_KEY, JSON.stringify(settings));
        renderAll();
    }

    function daysBetween(date1, date2) {
        const d1 = new Date(date1.getFullYear(), date1.getMonth(), date1.getDate());
        const d2 = new Date(date2.getFullYear(), date2.getMonth(), date2.getDate());
        return Math.round((d2 - d1) / (1000 * 60 * 60 * 24));
    }

    function getCycleDayForDate(date) {
        const start = new Date(settings.lastPeriodStart);
        const diff = daysBetween(start, date);
        if (diff < 0) return null;
        return (diff % settings.cycleLength) + 1;
    }

    function getPhaseByCycleDay(day) {
        const { periodLength, cycleLength } = settings;
        const ovulationDay = cycleLength - 14;

        if (day >= 1 && day <= periodLength) return 'menstruation';
        if (day > cycleLength - PMS_LENGTH) return 'pms';
        if (day === ovulationDay || day === ovulationDay - 1 || day === ovulationDay + 1) return 'ovulation';
        if (day > periodLength && day < ovulationDay - 1) return 'follicular';
        return 'luteal';
    }

    function renderCalendar() {
        const calendarGrid = document.getElementById('calendarGrid');
        calendarGrid.innerHTML = '';
        const month = viewDate.getMonth();
        const year = viewDate.getFullYear();

        document.getElementById('monthTitle').textContent = viewDate.toLocaleDateString('ru-RU', { month: 'long', year: 'numeric' });

        const weekdays = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];
        weekdays.forEach(day => {
            const dayEl = document.createElement('div');
            dayEl.className = 'themed-text-muted text-sm font-bold';
            dayEl.textContent = day;
            calendarGrid.appendChild(dayEl);
        });

        const firstDayOfMonth = new Date(year, month, 1);
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        let startingDay = firstDayOfMonth.getDay() - 1;
        if (startingDay === -1) startingDay = 6;

        for (let i = 0; i < startingDay; i++) {
            calendarGrid.appendChild(document.createElement('div'));
        }

        for (let i = 1; i <= daysInMonth; i++) {
            const date = new Date(year, month, i);
            const cycleDay = getCycleDayForDate(date);
            
            const dayEl = document.createElement('button');
            dayEl.className = 'day-cell w-full aspect-square flex items-center justify-center rounded-full text-sm';
            dayEl.textContent = i;
            
            if (cycleDay) {
                const phase = getPhaseByCycleDay(cycleDay);
                dayEl.classList.add(`day-${phase}`);
                dayEl.onclick = () => showDayInfo(date);
            } else {
                 dayEl.classList.add('themed-text-muted', 'opacity-50');
            }
            
            const today = new Date();
            if (date.toDateString() === today.toDateString()) {
                dayEl.style.outline = `2px solid var(--accent-color)`;
            }

            calendarGrid.appendChild(dayEl);
        }
    }
    
    function renderCycleTimeline() {
        const timeline = document.getElementById('cycle-timeline');
        const legend = document.getElementById('cycle-legend');
        timeline.innerHTML = '';
        legend.innerHTML = '';
        
        const { periodLength, cycleLength } = settings;
        const ovulationDay = cycleLength - 14;
        
        const phaseLengths = {
            menstruation: periodLength,
            follicular: (ovulationDay - 1) - periodLength,
            ovulation: 3,
            luteal: (cycleLength - PMS_LENGTH) - (ovulationDay + 1),
            pms: PMS_LENGTH
        };

        const todayCycleDay = getCycleDayForDate(new Date());

        let cumulativeDays = 0;
        for (const phaseKey in phaseLengths) {
            const phase = PHASES[phaseKey];
            const length = phaseLengths[phaseKey];
            if (length <= 0) continue;

            const segment = document.createElement('div');
            const width = (length / cycleLength) * 100;
            segment.style.width = `${width}%`;
            segment.style.backgroundColor = phase.color;

            if (todayCycleDay && todayCycleDay > cumulativeDays && todayCycleDay <= cumulativeDays + length) {
                segment.style.boxShadow = 'inset 0 0 0 2px white';
            }
            timeline.appendChild(segment);
            cumulativeDays += length;

            const legendItem = document.createElement('div');
            legendItem.className = 'flex items-center';
            legendItem.innerHTML = `<div class="w-2 h-2 rounded-full mr-2" style="background-color: ${phase.color};"></div><span class="themed-text">${phase.name}</span>`;
            legend.appendChild(legendItem);
        }
    }

    function showDayInfo(date) {
        const cycleDay = getCycleDayForDate(date);
        const titleEl = document.getElementById('selected-date-title');
        const phaseNameEl = document.getElementById('selected-phase-name');
        const recommendationsEl = document.getElementById('recommendations');
        
        titleEl.textContent = date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long', year: 'numeric' });
        recommendationsEl.innerHTML = '';

        if (!cycleDay) {
            phaseNameEl.textContent = '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ü–∏–∫–ª–µ –¥–ª—è —ç—Ç–æ–π –¥–∞—Ç—ã.';
            return;
        }

        const phaseKey = getPhaseByCycleDay(cycleDay);
        const phase = PHASES[phaseKey];
        
        phaseNameEl.innerHTML = `<span style="color: ${phase.color}">${phase.name}</span> ‚Äî ${cycleDay}-–π –¥–µ–Ω—å —Ü–∏–∫–ª–∞`;
        
        for (const [key, value] of Object.entries(phase.data)) {
            const item = document.createElement('div');
            item.innerHTML = `
                <h3 class="font-semibold themed-text">${key}</h3>
                <p class="themed-text-muted text-sm">${value}</p>
            `;
            recommendationsEl.appendChild(item);
        }

        applyTheme(phaseKey);
    }
    
    function updateTodaySummary() {
        const today = new Date();
        document.getElementById('today-date').textContent = today.toLocaleDateString('ru-RU', { weekday: 'long', day: 'numeric', month: 'long' });

        const cycleDay = getCycleDayForDate(today);
        if (cycleDay) {
            const phaseKey = getPhaseByCycleDay(cycleDay);
            const phase = PHASES[phaseKey];
            document.getElementById('today-phase-name').textContent = phase.name;
            document.getElementById('today-cycle-day').textContent = cycleDay;
            applyTheme(phaseKey);
        } else {
            document.getElementById('today-phase-name').textContent = '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
            document.getElementById('today-cycle-day').textContent = '--';
            applyTheme(null);
        }
    }

    function applyTheme(phaseKey) {
        document.body.className = 'p-4 sm:p-6 lg:p-8';
        if (phaseKey && PHASES[phaseKey]) {
            document.body.classList.add(PHASES[phaseKey].theme);
        }
    }
    
    function populateSettingsForm() {
        document.getElementById('startDate').value = settings.lastPeriodStart;
        document.getElementById('cycleLength').value = settings.cycleLength;
        document.getElementById('periodLength').value = settings.periodLength;
    }

    function renderAll() {
        updateTodaySummary();
        renderCalendar();
        renderCycleTimeline();
    }
    
    // Event Listeners
    document.getElementById('saveSettingsBtn').addEventListener('click', saveSettings);

    document.getElementById('prevMonth').onclick = () => {
        viewDate.setMonth(viewDate.getMonth() - 1);
        renderCalendar();
    };

    document.getElementById('nextMonth').onclick = () => {
        viewDate.setMonth(viewDate.getMonth() + 1);
        renderCalendar();
    };

    // Initial Load
    populateSettingsForm();
    renderAll();
    showDayInfo(new Date());
});
</script>
</body>
</html>
