<!DOCTYPE html>
<!-- –í—ã–±—Ä–∞–Ω–Ω–∞—è –ø–∞–ª–∏—Ç—Ä–∞: –≠–∑–æ—Ç–µ—Ä–∏—á–µ—Å–∫–∏–µ, —Å–æ—á–Ω—ã–µ, –ø—Ä–∏—Ä–æ–¥–Ω—ã–µ –æ—Ç—Ç–µ–Ω–∫–∏ —Å –∑–æ–ª–æ—Ç–æ–º –∏ —á—ë—Ä–Ω—ã–º. -->
<!-- –ü–ª–∞–Ω —Å—Ç—Ä—É–∫—Ç—É—Ä—ã –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è: –Ø —Ä–∞–∑—Ä–∞–±–æ—Ç–∞–ª —Å—Ç—Ä—É–∫—Ç—É—Ä—É –≤ –≤–∏–¥–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–æ–Ω–Ω–æ–π –ø–∞–Ω–µ–ª–∏ (dashboard) —Å –¥–≤—É–º—è –∫–æ–ª–æ–Ω–∫–∞–º–∏, –∫–æ—Ç–æ—Ä–∞—è –∞–¥–∞–ø—Ç–∏—Ä—É–µ—Ç—Å—è –ø–æ–¥ –º–æ–±–∏–ª—å–Ω—ã–µ —É—Å—Ç—Ä–æ–π—Å—Ç–≤–∞. –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏ —Ü–∏–∫–ª–∞) –∏ –∫–∞—Ä—Ç–æ—á–∫—É —Å –æ–±–∑–æ—Ä–æ–º —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∫ —Å–∞–º–æ–π –≤–∞–∂–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏. –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ —Å–æ–¥–µ—Ä–∂–∏—Ç –∏–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å –¥–ª—è –¥–µ—Ç–∞–ª—å–Ω–æ–≥–æ –∏–∑—É—á–µ–Ω–∏—è –∏ –ø–∞–Ω–µ–ª—å —Å –ø–æ–¥—Ä–æ–±–Ω–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–π —Ñ–∞–∑–µ. –¢–∞–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ —Ä–∞–∑–¥–µ–ª—è–µ—Ç –±—ã—Å—Ç—Ä—ã–π –æ–±–∑–æ—Ä –∏ –≥–ª—É–±–æ–∫–æ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ, —á—Ç–æ —É–ª—É—á—à–∞–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–π –æ–ø—ã—Ç, —Ç–∞–∫ –∫–∞–∫ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –ª–∏–±–æ –±—ã—Å—Ç—Ä–æ –ø–æ–ª—É—á–∏—Ç—å –Ω—É–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é, –ª–∏–±–æ –ø–æ–≥—Ä—É–∑–∏—Ç—å—Å—è –≤ –¥–µ—Ç–∞–ª–∏, –Ω–µ –ø–µ—Ä–µ–≥—Ä—É–∂–∞—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å. -->
<!-- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è –∏ –∫–æ–Ω—Ç–µ–Ω—Ç: 
- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ü–∏–∫–ª–∞ -> –¶–µ–ª—å: –í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö -> –ú–µ—Ç–æ–¥: –°—Ç–∏–ª–∏–∑–æ–≤–∞–Ω–Ω–∞—è —Ñ–æ—Ä–º–∞ -> –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ: –í–≤–æ–¥ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–º -> –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ: –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–π –∏ –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–æ –ø–æ–Ω—è—Ç–Ω—ã–π —Å–ø–æ—Å–æ–± –¥–ª—è –≤–≤–æ–¥–∞ –¥–∞–Ω–Ω—ã—Ö.
- –û–±–∑–æ—Ä —Ç–µ–∫—É—â–µ–≥–æ –¥–Ω—è -> –¶–µ–ª—å: –ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ -> –ú–µ—Ç–æ–¥: –ö–∞—Ä—Ç–æ—á–∫–∞ —Å –∫–ª—é—á–µ–≤–æ–π –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π (—Ñ–∞–∑–∞, –¥–µ–Ω—å —Ü–∏–∫–ª–∞) -> –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ: –ù–µ—Ç (—Ç–æ–ª—å–∫–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ) -> –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ: –ü—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç —Å–∞–º—É—é –≤–∞–∂–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –Ω–∞ –≤–∏–¥–Ω–æ–º –º–µ—Å—Ç–µ.
- –í—Ä–µ–º–µ–Ω–Ω–∞—è —à–∫–∞–ª–∞ —Ü–∏–∫–ª–∞ -> –¶–µ–ª—å: –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è, –ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ -> –ú–µ—Ç–æ–¥: –ì–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω–∞—è –ø–æ–ª–æ—Å–∞, —Å–æ–∑–¥–∞–Ω–Ω–∞—è —Å –ø–æ–º–æ—â—å—é HTML/CSS -> –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ: –ù–µ—Ç -> –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ: –î–∞—ë—Ç –Ω–∞–≥–ª—è–¥–Ω–æ–µ –ø—Ä–µ–¥—Å—Ç–∞–≤–ª–µ–Ω–∏–µ –æ –≤—Å—ë–º —Ü–∏–∫–ª–µ –∏ —Ç–µ–∫—É—â–µ–º –ø–æ–ª–æ–∂–µ–Ω–∏–∏ –≤ –Ω—ë–º.
- –ö–∞–ª–µ–Ω–¥–∞—Ä—å -> –¶–µ–ª—å: –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ -> –ú–µ—Ç–æ–¥: –ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω–∞—è —Å–µ—Ç–∫–∞ –¥–Ω–µ–π (HTML/CSS/JS) -> –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ: –ö–ª–∏–∫ –ø–æ –¥–Ω—é –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è –¥–µ—Ç–∞–ª–µ–π, –Ω–∞–≤–∏–≥–∞—Ü–∏—è –ø–æ –º–µ—Å—è—Ü–∞–º -> –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ: –ö–ª–∞—Å—Å–∏—á–µ—Å–∫–∏–π –∏ —ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω—ã–π —Å–ø–æ—Å–æ–± –≤–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏–∏ –º–µ—Å—è—Ü–∞.
- –î–µ—Ç–∞–ª–∏ —Ñ–∞–∑—ã -> –¶–µ–ª—å: –ò–Ω—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–∏–µ, –†–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ -> –ú–µ—Ç–æ–¥: –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π —Ç–µ–∫—Å—Ç —Å –∏–∫–æ–Ω–∫–∞–º–∏ –∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞–º–∏ -> –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ: –û–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –ø—Ä–∏ –∫–ª–∏–∫–µ –Ω–∞ –¥–µ–Ω—å -> –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ: –†–∞–∑–¥–µ–ª–µ–Ω–∏–µ –±–æ–ª—å—à–æ–≥–æ —Ç–µ–∫—Å—Ç–∞ –Ω–∞ –±–ª–æ–∫–∏ –∑–Ω–∞—á–∏—Ç–µ–ª—å–Ω–æ —É–ª—É—á—à–∞–µ—Ç —á–∏—Ç–∞–µ–º–æ—Å—Ç—å –∏ –≤–æ—Å–ø—Ä–∏—è—Ç–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏.
- –ë–∏–±–ª–∏–æ—Ç–µ–∫–∏/–ú–µ—Ç–æ–¥—ã: –¢–æ–ª—å–∫–æ Vanilla JS –∏ Tailwind CSS. Chart.js –Ω–µ —Ç—Ä–µ–±—É–µ—Ç—Å—è, —Ç–∞–∫ –∫–∞–∫ –Ω–µ—Ç —Å–ª–æ–∂–Ω—ã—Ö –¥–∏–∞–≥—Ä–∞–º–º.
-->
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ñ–µ–Ω—Å–∫–∏–π –∫–∞–ª–µ–Ω–¥–∞—Ä—å - –ü–∞–Ω–µ–ª—å —Ü–∏–∫–ª–∞</title>
    <!-- PWA - –ú–µ—Ç–∞-—Ç–µ–≥–∏ -->
    <meta name="theme-color" content="#1a1e27"/>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --bg-color: #1a1e27;
            --card-bg: #28303d;
            --text-color: #e8e8e8;
            --text-muted: #8894a4;
            --accent-color: #d4af37;
            --border-color: #444c59;
        }

        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-color);
            color: var(--text-color);
            transition: background-color 0.5s ease;
        }

        .card {
            background-color: var(--card-bg);
            border-color: var(--border-color);
            transition: background-color 0.5s ease, border-color 0.5s ease;
        }

        .themed-text { color: var(--text-color); }
        .themed-text-muted { color: var(--text-muted); }
        
        /* –¢–µ–º—ã, –∑–∞–≤–∏—Å—è—â–∏–µ –æ—Ç —Ñ–∞–∑—ã —Ü–∏–∫–ª–∞ */
        /* –ú–µ–Ω—Å—Ç—Ä—É–∞—Ü–∏—è: –≥–ª—É–±–æ–∫–∏–π —Ç–µ–º–Ω–æ-—Å–∏–Ω–∏–π + –≥—Ä–∞–¥–∏–µ–Ω—Ç —Å–∏–Ω–µ–≥–æ */
        body.theme-menstruation { 
            --bg-color: #040910; 
            --card-bg: #0e1624; 
            --text-color: #e8f0ff; 
            --text-muted: #9abedb; 
            --accent-color: #d4af37; 
            --border-color: #1a2a40;
            background-image: linear-gradient(to bottom, #040910, #0c1a2c);
        }
        .day-menstruation { background-color: #040910; color: white; }

        /* –§–æ–ª–ª–∏–∫—É–ª—è—Ä–Ω–∞—è: —Ç—ë–º–Ω—ã–π –∏–∑—É–º—Ä—É–¥–Ω—ã–π + –≥—Ä–∞–¥–∏–µ–Ω—Ç –∑–µ–ª—ë–Ω–æ–≥–æ */
        body.theme-follicular { 
            --bg-color: #002e20; 
            --card-bg: #004d3d; 
            --text-color: #e0fff2; 
            --text-muted: #8cd8b8; 
            --accent-color: #d4af37; 
            --border-color: #00604e;
            background-image: linear-gradient(to bottom, #002e20, #004d3d);
        }
        .day-follicular { background-color: #002e20; color: white; }

        /* –û–≤—É–ª—è—Ü–∏—è: –ø–∞—Å—Ç–µ–ª—å–Ω—ã–π –æ—Ç—Ç–µ–Ω–æ–∫ –∂—ë–ª—Ç–æ–≥–æ */
        body.theme-ovulation { 
            --bg-color: #FFFACD; 
            --card-bg: #F0E68C; 
            --text-color: #4A3E26; 
            --text-muted: #6B5C40; 
            --accent-color: #000000; 
            --border-color: #d4af37;
            background-image: radial-gradient(circle at center, #FFFACD, #FAFAD2);
        }
        .day-ovulation { background-color: #FFFACD; color: black; }

        /* –õ—é—Ç–µ–∏–Ω–æ–≤–∞—è: –ø—É—Ä–ø—É—Ä–Ω—ã–π -> –Ω–µ–∂–Ω—ã–π —Ñ–∏–æ–ª–µ—Ç–æ–≤—ã–π + –≥—Ä–∞–¥–∏–µ–Ω—Ç –∂—ë–ª—Ç–æ–≥–æ */
        body.theme-luteal { 
            --bg-color: #5d436b; 
            --card-bg: #7c5d8a; 
            --text-color: #fce4ec; 
            --text-muted: #d4a09a; 
            --accent-color: #d4af37; 
            --border-color: #6a1b9a;
            background-image: linear-gradient(to bottom, #a47bb1, #7c5d8a);
        }
        .day-luteal { background-color: #a47bb1; color: white; }
        
        /* –ü–ú–°: —Ç—ë–º–Ω–æ-—Å–∏—Ä–µ–Ω–µ–≤—ã–π + –≥—Ä–∞–¥–∏–µ–Ω—Ç —Å–∏–Ω–µ–≥–æ */
        body.theme-pms { 
            --bg-color: #3b2c45; 
            --card-bg: #5a3d66; 
            --text-color: #f7e8ff; 
            --text-muted: #d0b8d8; 
            --accent-color: #d4af37; 
            --border-color: #4c3359; 
            background-image: linear-gradient(to bottom, #3b2c45, #2a2030);
        }
        .day-pms { background-color: #3b2c45; color: white; }

        .day-cell { transition: transform 0.2s ease, box-shadow 0.2s ease; }
        .day-cell:hover { transform: translateY(-3px); box-shadow: 0 4px 12px rgba(0,0,0,0.08); }
    </style>
</head>
<body class="p-4 sm:p-6 lg:p-8">

    <div class="max-w-7xl mx-auto">
        <header class="mb-8">
            <h1 class="text-3xl font-bold themed-text">–ü–∞–Ω–µ–ª—å –∂–µ–Ω—Å–∫–æ–≥–æ —Ü–∏–∫–ª–∞</h1>
            <p class="themed-text-muted mt-1">–ê–Ω–∞–ª–∏–∑–∏—Ä—É–π—Ç–µ —Å–≤–æ–π —Ü–∏–∫–ª –∏ –∂–∏–≤–∏—Ç–µ –≤ –≥–∞—Ä–º–æ–Ω–∏–∏ —Å –µ–≥–æ —Ñ–∞–∑–∞–º–∏.</p>
        </header>

        <main class="grid grid-cols-1 lg:grid-cols-3 xl:grid-cols-4 gap-6">

            <!-- –õ–µ–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
            <aside class="lg:col-span-1 xl:col-span-1 flex flex-col gap-6">
                <!-- –°–≤–æ–¥–∫–∞ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è -->
                <section id="today-summary-card" class="card border rounded-2xl p-6">
                    <h2 class="text-sm font-semibold uppercase tracking-wider themed-text-muted">–°–µ–≥–æ–¥–Ω—è</h2>
                    <p id="today-date" class="text-xl font-bold themed-text"></p>
                    <div class="mt-4">
                        <p class="text-4xl font-bold" style="color: var(--accent-color);" id="today-phase-name">–ó–∞–≥—Ä—É–∑–∫–∞...</p>
                        <p class="themed-text-muted"><span id="today-cycle-day">--</span> –¥–µ–Ω—å —Ü–∏–∫–ª–∞</p>
                    </div>
                </section>
                
                <!-- –í–∏–∑—É–∞–ª–∏–∑–∞—Ü–∏—è —Ü–∏–∫–ª–∞ -->
                <section class="card border rounded-2xl p-6">
                    <h2 class="text-sm font-semibold uppercase tracking-wider themed-text-muted mb-4">–í–∞—à —Ü–∏–∫–ª</h2>
                    <div id="cycle-timeline" class="w-full flex rounded-full h-3 overflow-hidden"></div>
                    <div id="cycle-legend" class="text-xs mt-3 grid grid-cols-2 gap-x-4 gap-y-1"></div>
                </section>
            </aside>

            <!-- –ü—Ä–∞–≤–∞—è –∫–æ–ª–æ–Ω–∫–∞ -->
            <div class="lg:col-span-2 xl:col-span-3 flex flex-col gap-6">
                <!-- –ö–∞–ª–µ–Ω–¥–∞—Ä—å -->
                <section class="card border rounded-2xl p-6">
                    <div class="flex items-center justify-between mb-4">
                        <h2 id="monthTitle" class="text-xl font-bold themed-text"></h2>
                        <div class="flex items-center gap-2">
                            <button id="prevMonth" class="p-2 rounded-md hover:bg-black/5 themed-text-muted">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M12.707 5.293a1 1 0 010 1.414L9.414 10l3.293 3.293a1 1 0 01-1.414 1.414l-4-4a1 1 0 010-1.414l4-4a1 1 0 011.414 0z" clip-rule="evenodd" /></svg>
                            </button>
                            <button id="nextMonth" class="p-2 rounded-md hover:bg-black/5 themed-text-muted">
                                <svg xmlns="http://www.w3.org/2000/svg" class="h-5 w-5" viewBox="0 0 20 20" fill="currentColor"><path fill-rule="evenodd" d="M7.293 14.707a1 1 0 010-1.414L10.586 10 7.293 6.707a1 1 0 011.414-1.414l4 4a1 1 0 010 1.414l-4 4a1 1 0 01-1.414 0z" clip-rule="evenodd" /></svg>
                            </button>
                        </div>
                    </div>
                    <div id="calendarGrid" class="grid grid-cols-7 gap-1 text-center"></div>
                </section>
                
                <!-- –î–µ—Ç–∞–ª–∏ —Ñ–∞–∑—ã -->
                <section id="info-panel" class="card border rounded-2xl p-6">
                    <div id="info-content">
                        <h2 class="text-xl font-bold themed-text" id="selected-date-title">–í—ã–±–µ—Ä–∏—Ç–µ –¥–µ–Ω—å –≤ –∫–∞–ª–µ–Ω–¥–∞—Ä–µ</h2>
                        <p class="themed-text-muted" id="selected-phase-name">–ó–¥–µ—Å—å –ø–æ—è–≤–∏—Ç—Å—è –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ —Ñ–∞–∑–µ —Ü–∏–∫–ª–∞.</p>
                        <div id="recommendations" class="mt-4 space-y-4"></div>
                    </div>
                </section>
            </div>

            <!-- –ù–∞—Å—Ç—Ä–æ–π–∫–∏ -->
            <section class="card border rounded-2xl p-6 col-span-full">
                <h2 class="text-lg font-bold themed-text mb-4">–ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Ü–∏–∫–ª–∞</h2>
                <div class="space-y-4">
                    <div>
                        <label for="startDate" class="block text-sm font-medium themed-text-muted">–î–∞—Ç–∞ –Ω–∞—á–∞–ª–∞ –ø–æ—Å–ª–µ–¥–Ω–µ–≥–æ —Ü–∏–∫–ª–∞</label>
                        <input id="startDate" type="date" class="mt-1 block w-full bg-transparent border rounded-md p-2 themed-text border-gray-600/20">
                    </div>
                    <div>
                        <label for="cycleLength" class="block text-sm font-medium themed-text-muted">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ü–∏–∫–ª–∞ (–¥–Ω–µ–π)</label>
                        <input id="cycleLength" type="number" min="20" max="45" value="28" class="mt-1 block w-full bg-transparent border rounded-md p-2 themed-text border-gray-600/20">
                    </div>
                    <div>
                        <label for="periodLength" class="block text-sm font-medium themed-text-muted">–î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –º–µ–Ω—Å—Ç—Ä—É–∞—Ü–∏–∏ (–¥–Ω–µ–π)</label>
                        <input id="periodLength" type="number" min="1" max="10" value="5" class="mt-1 block w-full bg-transparent border rounded-md p-2 themed-text border-gray-600/20">
                    </div>
                </div>
                <button id="saveSettingsBtn" class="mt-6 w-full py-2 px-4 rounded-md bg-black text-white font-semibold hover:bg-zinc-800 transition">
                    <span class="text-gold-300">–°–æ—Ö—Ä–∞–Ω–∏—Ç—å</span>
                </button>
            </section>
        </main>
    </div>

<script>
document.addEventListener('DOMContentLoaded', () => {
    // PWA - –õ–æ–≥–∏–∫–∞ —É—Å—Ç–∞–Ω–æ–≤–∫–∏ –±—ã–ª–∞ —É–¥–∞–ª–µ–Ω–∞, —Ç–∞–∫ –∫–∞–∫ —Ç—Ä–µ–±—É–µ—Ç –æ—Ç–¥–µ–ª—å–Ω–æ–≥–æ —Ñ–∞–π–ª–∞ Service Worker,
    // –∫–æ—Ç–æ—Ä—ã–π –Ω–µ –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç—Å—è –≤ –¥–∞–Ω–Ω–æ–π –æ–¥–Ω–æ—Ñ–∞–π–ª–æ–≤–æ–π —Å—Ä–µ–¥–µ.
    
    // –î–ª–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å –ü–ú–°, —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∫–æ–Ω—Å—Ç–∞–Ω—Ç–∞.
    const PMS_LENGTH = 6;
    
    // –û–±—ä–µ–∫—Ç, –æ–ø–∏—Å—ã–≤–∞—é—â–∏–π –≤—Å–µ —Ñ–∞–∑—ã —Ü–∏–∫–ª–∞ —Å –∏—Ö –¥–∞–Ω–Ω—ã–º–∏
    const PHASES = {
        menstruation: {
            name: '–ú–µ–Ω—Å—Ç—Ä—É–∞—Ü–∏—è',
            theme: 'theme-menstruation',
            color: '#040910',
            data: {
                "üåÄ –ì–æ—Ä–º–æ–Ω—ã": "–£—Ä–æ–≤–µ–Ω—å —ç—Å—Ç—Ä–æ–≥–µ–Ω–∞ –∏ –ø—Ä–æ–≥–µ—Å—Ç–µ—Ä–æ–Ω–∞ –Ω–∏–∑–∫–∏–π.",
                "‚ù§Ô∏è –°–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ": "–£—Å—Ç–∞–ª–æ—Å—Ç—å, –∏–Ω—Ç—Ä–æ–≤–µ—Ä—Å–∏—è, –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ —É–µ–¥–∏–Ω–µ–Ω–∏–∏. –ü–æ–≤—ã—à–µ–Ω–Ω–∞—è –∏–Ω—Ç—É–∏—Ü–∏—è.",
                "üìã –ó–∞–¥–∞—á–∏": "–û—Ç–¥—ã—Ö, –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ, –ª—ë–≥–∫–æ–µ –ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ, –ø–æ–¥–≤–µ–¥–µ–Ω–∏–µ –∏—Ç–æ–≥–æ–≤.",
                "‚ú® –†–∏—Ç—É–∞–ª—ã": "–ú–µ–¥–∏—Ç–∞—Ü–∏—è –≤ —Ç–∏—à–∏–Ω–µ, —Å–ø–∞, –≤–µ–¥–µ–Ω–∏–µ –¥–Ω–µ–≤–Ω–∏–∫–∞.",
                "üèÉ‚Äç‚ôÄÔ∏è –î–≤–∏–∂–µ–Ω–∏–µ": "–†–∞—Å—Å–ª–∞–±–ª—è—é—â–∏–µ –ø—Ä–∞–∫—Ç–∏–∫–∏, —Ä–∞—Å—Ç—è–∂–∫–∞, –ø–∞—Å—Å–∏–≤–Ω—ã–µ –ø–æ–∑—ã –π–æ–≥–∏.",
                "ü•ó –ü–∏—Ç–∞–Ω–∏–µ": "–¢—ë–ø–ª–∞—è –∏ –º—è–≥–∫–∞—è –ø–∏—â–∞: –∫–∞—à–∏, —Å—É–ø—ã, —Ç—É—à—ë–Ω—ã–µ –æ–≤–æ—â–∏, –Ω–µ–∂–∏—Ä–Ω—ã–π –±–µ–ª–æ–∫.",
                "üåå –î—É—Ö–æ–≤–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã": "–°–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å –õ—É–Ω–Ω–æ–π –ë–æ–≥–∏–Ω–µ–π. –≠—Ç–æ –≤—Ä–µ–º—è –¥–ª—è –ø–æ–≥—Ä—É–∂–µ–Ω–∏—è –≤ —Å–µ–±—è, –ø–æ–¥–æ–±–Ω–æ —Ç–æ–º—É, –∫–∞–∫ –Ω–æ–≤–æ–ª—É–Ω–∏–µ —Å–∫—Ä—ã–≤–∞–µ—Ç —Å–≤–æ—é —ç–Ω–µ—Ä–≥–∏—é. –í—ã –º–æ–∂–µ—Ç–µ –æ–±—Ä–µ—Å—Ç–∏ –æ—Ç–≤–µ—Ç—ã –Ω–∞ —Å–æ–∫—Ä–æ–≤–µ–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã, —Å–ª—É—à–∞—è —Å–≤–æ—é –∏–Ω—Ç—É–∏—Ü–∏—é. –í—Ä–µ–º—è –¥–ª—è –æ—á–∏—â–µ–Ω–∏—è –∏ –æ—Å–≤–æ–±–æ–∂–¥–µ–Ω–∏—è –æ—Ç –≤—Å–µ–≥–æ —Å—Ç–∞—Ä–æ–≥–æ."
            }
        },
        follicular: {
            name: '–§–æ–ª–ª–∏–∫—É–ª—è—Ä–Ω–∞—è',
            theme: 'theme-follicular',
            color: '#002e20',
            data: {
                "üåÄ –ì–æ—Ä–º–æ–Ω—ã": "–ü–æ—Å—Ç–µ–ø–µ–Ω–Ω—ã–π —Ä–æ—Å—Ç —ç—Å—Ç—Ä–æ–≥–µ–Ω–∞.",
                "‚ù§Ô∏è –°–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ": "–ü—Ä–∏–ª–∏–≤ —ç–Ω–µ—Ä–≥–∏–∏, –ª—ë–≥–∫–æ—Å—Ç—å, —è—Å–Ω–æ—Å—Ç—å —É–º–∞, —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å, —Å–æ—Ü–∏–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å.",
                "üìã –ó–∞–¥–∞—á–∏": "–ù–æ–≤—ã–µ –Ω–∞—á–∏–Ω–∞–Ω–∏—è, –∞–∫—Ç–∏–≤–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è, —Ç–≤–æ—Ä—á–µ—Å—Ç–≤–æ, –º–æ–∑–≥–æ–≤—ã–µ —à—Ç—É—Ä–º—ã.",
                "‚ú® –†–∏—Ç—É–∞–ª—ã": "–õ—ë–≥–∫–∞—è —É—Ç—Ä–µ–Ω–Ω—è—è —Ä–∞–∑–º–∏–Ω–∫–∞, —Ç–∞–Ω–µ—Ü, –ø–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏–π –Ω–∞ —Ü–∏–∫–ª.",
                "üèÉ‚Äç‚ôÄÔ∏è –î–≤–∏–∂–µ–Ω–∏–µ": "–î–∏–Ω–∞–º–∏—á–Ω—ã–µ —Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏, –∫–∞—Ä–¥–∏–æ, —Ç–∞–Ω—Ü—ã.",
                "ü•ó –ü–∏—Ç–∞–Ω–∏–µ": "–°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ: –±–µ–ª–∫–∏, —Å–ª–æ–∂–Ω—ã–µ —É–≥–ª–µ–≤–æ–¥—ã, —Å–≤–µ–∂–∏–µ –æ–≤–æ—â–∏ –∏ —Ñ—Ä—É–∫—Ç—ã.",
                "üåå –î—É—Ö–æ–≤–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã": "–í–æ—Å—Å–æ–µ–¥–∏–Ω–µ–Ω–∏–µ —Å —ç–Ω–µ—Ä–≥–∏–µ–π –≤–µ—Å–µ–Ω–Ω–µ–≥–æ –≤–æ–∑—Ä–æ–∂–¥–µ–Ω–∏—è. –í–∞—à–∞ –≤–Ω—É—Ç—Ä–µ–Ω–Ω—è—è '–≤–æ–∏–Ω—Å—Ç–≤–µ–Ω–Ω–∞—è' —ç–Ω–µ—Ä–≥–∏—è –ø—Ä–æ–±—É–∂–¥–∞–µ—Ç—Å—è. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –µ—ë –¥–ª—è –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è —Ü–µ–ª–µ–π, —Å–ª–æ–≤–Ω–æ —Å–∞–∂–∞–µ—Ç–µ —Å–µ–º–µ–Ω–∞, –∫–æ—Ç–æ—Ä—ã–µ —Å–∫–æ—Ä–æ –ø—Ä–∏–Ω–µ—Å—É—Ç –ø–ª–æ–¥—ã."
            }
        },
        ovulation: {
            name: '–û–≤—É–ª—è—Ü–∏—è',
            theme: 'theme-ovulation',
            color: '#FFFACD',
            data: {
                "üåÄ –ì–æ—Ä–º–æ–Ω—ã": "–ü–∏–∫ –ª—é—Ç–µ–∏–Ω–∏–∑–∏—Ä—É—é—â–µ–≥–æ –≥–æ—Ä–º–æ–Ω–∞ (–õ–ì) –∏ —ç—Å—Ç—Ä–æ–≥–µ–Ω–∞.",
                "‚ù§Ô∏è –°–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ": "–ú–∞–∫—Å–∏–º—É–º —ç–Ω–µ—Ä–≥–∏–∏, –≤—ã—Å–æ–∫–∞—è —Å–µ–∫—Å—É–∞–ª—å–Ω–æ—Å—Ç—å, –º–∞–≥–Ω–µ—Ç–∏–∑–º, –∂–µ–Ω—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç—å.",
                "üìã –ó–∞–¥–∞—á–∏": "–°–æ—Ü–∏–∞–ª—å–Ω–∞—è –∞–∫—Ç–∏–≤–Ω–æ—Å—Ç—å, –≤—ã—Å—Ç—É–ø–ª–µ–Ω–∏—è, —Å–≤–∏–¥–∞–Ω–∏—è, —Ç–≤–æ—Ä—á–µ—Å–∫–∏–µ –ø—Ä–æ–µ–∫—Ç—ã.",
                "‚ú® –†–∏—Ç—É–∞–ª—ã": "–î—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏, –∞—Ñ—Ñ–∏—Ä–º–∞—Ü–∏–∏ –Ω–∞ –ø—Ä–æ—è–≤–ª–µ–Ω–∏–µ –∂–µ–Ω—Å—Ç–≤–µ–Ω–Ω–æ—Å—Ç–∏.",
                "üèÉ‚Äç‚ôÄÔ∏è –î–≤–∏–∂–µ–Ω–∏–µ": "–†–∞—Å–∫—Ä—ã–≤–∞—é—â–∏–µ –∂–µ—Å—Ç—ã, –∫—Ä—É–≥–æ–≤—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è, –π–æ–≥–∞ –¥–ª—è —Ä–∞—Å–∫—Ä—ã—Ç–∏—è —Ç–∞–∑–∞.",
                "ü•ó –ü–∏—Ç–∞–Ω–∏–µ": "–õ—ë–≥–∫–∞—è –ø–∏—â–∞: —Å–∞–ª–∞—Ç—ã, —Å–º—É–∑–∏, –∫–∏–Ω–æ–∞, –º–æ—Ä–µ–ø—Ä–æ–¥—É–∫—Ç—ã.",
                "üåå –î—É—Ö–æ–≤–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã": "–≠—Ç–æ –ø–æ–ª–Ω–æ–ª—É–Ω–∏–µ –≤–∞—à–µ–≥–æ —Ü–∏–∫–ª–∞. –≠–Ω–µ—Ä–≥–∏—è –Ω–∞ –ø–∏–∫–µ, –≤—ã —Å–∏—è–µ—Ç–µ. –í—Ä–µ–º—è –¥–ª—è –ø—Ä–æ—è–≤–ª–µ–Ω–∏—è –≤–∞—à–∏—Ö –∂–µ–ª–∞–Ω–∏–π –∏ —Å–æ–∑–∏–¥–∞–Ω–∏—è. –í—ã - –∏—Å—Ç–æ—á–Ω–∏–∫ —Å–∏–ª—ã –∏ –≤–¥–æ—Ö–Ω–æ–≤–µ–Ω–∏—è. –ü–æ–∑–≤–æ–ª—å—Ç–µ —Å–≤–æ–µ–π –∏–Ω—Ç—É–∏—Ü–∏–∏ –∏ —Ç–≤–æ—Ä—á–µ—Å—Ç–≤—É —Ç–µ—á—å —Å–≤–æ–±–æ–¥–Ω–æ."
            }
        },
        luteal: {
            name: '–õ—é—Ç–µ–∏–Ω–æ–≤–∞—è',
            theme: 'theme-luteal',
            color: '#a47bb1',
            data: {
                "üåÄ –ì–æ—Ä–º–æ–Ω—ã": "–í—ã—Å–æ–∫–∏–π —É—Ä–æ–≤–µ–Ω—å –ø—Ä–æ–≥–µ—Å—Ç–µ—Ä–æ–Ω–∞.",
                "‚ù§Ô∏è –°–∞–º–æ—á—É–≤—Å—Ç–≤–∏–µ": "–°—Ç–∞–±–∏–ª—å–Ω–æ—Å—Ç—å, –∑–∞—Ç–µ–º –≤–æ–∑–º–æ–∂–Ω–∞ —ç–º–æ—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å, –∏–Ω—Ç—É–∏—Ü–∏—è, —Ç—Ä–µ–≤–æ–∂–Ω–æ—Å—Ç—å.",
                "üìã –ó–∞–¥–∞—á–∏": "–ó–∞–±–æ—Ç–∞ –æ —Å–µ–±–µ –∏ –¥–æ–º–µ, –≤–µ–¥–µ–Ω–∏–µ –¥–Ω–µ–≤–Ω–∏–∫–∞, —Å–ø–æ–∫–æ–π–Ω—ã–µ –∏ —Ä—É—Ç–∏–Ω–Ω—ã–µ –¥–µ–ª–∞.",
                "‚ú® –†–∏—Ç—É–∞–ª—ã": "–ú–µ–¥–∏—Ç–∞—Ü–∏–∏ –±–ª–∞–≥–æ–¥–∞—Ä–Ω–æ—Å—Ç–∏, —Ç—ë–ø–ª—ã–π —á–∞–π, —É—é—Ç–Ω—ã–µ –≤–µ—á–µ—Ä–∞.",
                "üèÉ‚Äç‚ôÄÔ∏è –î–≤–∏–∂–µ–Ω–∏–µ": "–ü–ª–∞–≤–Ω—ã–µ –¥–≤–∏–∂–µ–Ω–∏—è, —Å–∞–º–æ–º–∞—Å—Å–∞–∂, —Å–ø–æ–∫–æ–π–Ω–∞—è –π–æ–≥–∞.",
                "ü•ó –ü–∏—Ç–∞–Ω–∏–µ": "–ü–∏—Ç–∞—Ç–µ–ª—å–Ω–∞—è –∏ –º—è–≥–∫–∞—è –ø–∏—â–∞: —Å—É–ø—ã-–ø—é—Ä–µ, –∫–∞—à–∏, –∑–∞–ø–µ—á—ë–Ω–Ω—ã–µ –æ–≤–æ—â–∏.",
                "üåå –î—É—Ö–æ–≤–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã": "–§–∞–∑–∞ —Å–æ–±–∏—Ä–∞–Ω–∏—è —É—Ä–æ–∂–∞—è. –ü—Ä–∏—à–ª–æ –≤—Ä–µ–º—è –ø–æ–∂–∏–Ω–∞—Ç—å –ø–ª–æ–¥—ã —Å–≤–æ–∏—Ö —Ç—Ä—É–¥–æ–≤, –Ω–æ —Ç–∞–∫–∂–µ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫ —Å–ª–µ–¥—É—é—â–µ–º—É —Ü–∏–∫–ª—É. –°–æ—Ö—Ä–∞–Ω—è–π—Ç–µ —ç–Ω–µ—Ä–≥–∏—é, –∑–∞–≤–µ—Ä—à–∞–π—Ç–µ –Ω–∞—á–∞—Ç–æ–µ, –∏ –≤–æ–∑–≤—Ä–∞—â–∞–π—Ç–µ—Å—å –∫ —Å–µ–±–µ. –í—Ä–µ–º—è –¥–ª—è –ø—Ä–æ—è–≤–ª–µ–Ω–∏—è —Ç–µ—Ä–ø–µ–Ω–∏—è –∏ –ø—Ä–∏–Ω—è—Ç–∏—è."
            }
        },
        pms: {
            name: '–ü–ú–°',
            theme: 'theme-pms',
            color: '#3b2c45',
            data: {
                "üåÄ –ì–æ—Ä–º–æ–Ω—ã": "–°–æ–Ω–ª–∏–≤–æ—Å—Ç—å, —Ä–∞–∑–¥—Ä–∞–∂–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å, –≥—Ä—É—Å—Ç—å, –Ω–æ—Å—Ç–∞–ª—å–≥–∏—è.",
                "üìã –ó–∞–¥–∞—á–∏": "–ú–∏–Ω–∏–º—É–º –¥–µ–ª, —Å–±–æ—Ä —ç–Ω–µ—Ä–≥–∏–∏, –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –º–µ–Ω—Å—Ç—Ä—É–∞—Ü–∏–∏.",
                "‚ú® –†–∏—Ç—É–∞–ª—ã": "–£–∫—É—Ç–∞—Ç—å—Å—è –≤ –ø–ª–µ–¥, —Ç—ë–ø–ª—ã–π –Ω–∞–ø–∏—Ç–æ–∫, –æ—á–∏—â–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–∞.",
                "üèÉ‚Äç‚ôÄÔ∏è –î–≤–∏–∂–µ–Ω–∏–µ": "–õ—ë–∂–∞-–π–æ–≥–∞, –¥—ã—Ö–∞—Ç–µ–ª—å–Ω—ã–µ –ø—Ä–∞–∫—Ç–∏–∫–∏ –¥–ª—è —É—Å–ø–æ–∫–æ–µ–Ω–∏—è.",
                "ü•ó –ü–∏—Ç–∞–Ω–∏–µ": "–¢—ë–ø–ª–æ–µ –∏ –æ–±–≤–æ–ª–∞–∫–∏–≤–∞—é—â–µ–µ: –∫—Ä–µ–º-—Å—É–ø—ã, –∑–∞–ø–µ—á—ë–Ω–Ω—ã–µ —è–±–ª–æ–∫–∏, –±–∞–Ω–∞–Ω—ã.",
                "üåå –î—É—Ö–æ–≤–Ω—ã–µ –∞—Å–ø–µ–∫—Ç—ã": "–í—Ä–µ–º—è ¬´–í–µ–¥—å–º—ã¬ª –∏–ª–∏ –º—É–¥—Ä–æ–π –∂–µ–Ω—â–∏–Ω—ã. –≠—Ç–æ —Å–∞–º–∞—è –∏–Ω—Ç—É–∏—Ç–∏–≤–Ω–∞—è –∏ –¥—É—Ö–æ–≤–Ω–∞—è —á–∞—Å—Ç—å —Ü–∏–∫–ª–∞. –í—ã –º–æ–∂–µ—Ç–µ —á—É–≤—Å—Ç–≤–æ–≤–∞—Ç—å —Å–∏–ª—å–Ω–æ–µ –∂–µ–ª–∞–Ω–∏–µ —É–µ–¥–∏–Ω–∏—Ç—å—Å—è, —á—Ç–æ —Å–æ–≤–µ—Ä—à–µ–Ω–Ω–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ. –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ —ç—Ç–æ –≤—Ä–µ–º—è, —á—Ç–æ–±—ã –æ—Ç–ø—É—Å—Ç–∏—Ç—å –≤—Å—ë, —á—Ç–æ –±–æ–ª—å—à–µ –Ω–µ —Å–ª—É–∂–∏—Ç –≤–∞–º, –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∏—Ç—å—Å—è –∫ –Ω–æ–≤–æ–º—É –Ω–∞—á–∞–ª—É."
            }
        }
    };

    const STORAGE_KEY = 'femaleCycleDashboardSettings';
    // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ—Ç–æ–±—Ä–∞–∂–∞–µ–º–æ–π –¥–∞—Ç—ã
    let viewDate = new Date();
    viewDate.setDate(1);

    // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    const defaultSettings = {
        lastPeriodStart: new Date(new Date().setDate(new Date().getDate() - 10)).toISOString().slice(0, 10),
        cycleLength: 28,
        periodLength: 5
    };

    // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –∏–∑ localStorage –∏–ª–∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –Ω–∞—Å—Ç—Ä–æ–µ–∫ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
    let settings = JSON.parse(localStorage.getItem(STORAGE_KEY)) || defaultSettings;

    // –§—É–Ω–∫—Ü–∏—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è –Ω–∞—Å—Ç—Ä–æ–µ–∫
    function saveSettings() {
        const startDateEl = document.getElementById('startDate');
        const cycleLengthEl = document.getElementById('cycleLength');
        const periodLengthEl = document.getElementById('periodLength');

        settings.lastPeriodStart = startDateEl.value;
        settings.cycleLength = parseInt(cycleLengthEl.value);
        settings.periodLength = parseInt(periodLengthEl.value);

        localStorage.setItem(STORAGE_KEY, JSON.stringify(settings));
        renderAll();
    }

    // –†–∞—Å—á–µ—Ç —Ä–∞–∑–Ω–∏—Ü—ã –≤ –¥–Ω—è—Ö –º–µ–∂–¥—É –¥–≤—É–º—è –¥–∞—Ç–∞–º–∏
    function daysBetween(date1, date2) {
        const d1 = new Date(date1.getFullYear(), date1.getMonth(), date1.getDate());
        const d2 = new Date(date2.getFullYear(), date2.getMonth(), date2.getDate());
        return Math.round((d2 - d1) / (1000 * 60 * 60 * 24));
    }

    // –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–Ω—è —Ü–∏–∫–ª–∞ –¥–ª—è –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π –¥–∞—Ç—ã
    function getCycleDayForDate(date) {
        const start = new Date(settings.lastPeriodStart);
        const diff = daysBetween(start, date);
        if (diff < 0) return null;
        return (diff % settings.cycleLength) + 1;
    }

    // –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Ñ–∞–∑—ã —Ü–∏–∫–ª–∞ –ø–æ –¥–Ω—é —Ü–∏–∫–ª–∞
    function getPhaseByCycleDay(day) {
        const { periodLength, cycleLength } = settings;
        const ovulationDay = cycleLength - 14;

        if (day >= 1 && day <= periodLength) return 'menstruation';
        if (day > cycleLength - PMS_LENGTH) return 'pms';
        if (day >= ovulationDay - 1 && day <= ovulationDay + 1) return 'ovulation';
        if (day > periodLength && day < ovulationDay - 1) return 'follicular';
        return 'luteal';
    }

    // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –∫–∞–ª–µ–Ω–¥–∞—Ä—è
    function renderCalendar() {
        const calendarGrid = document.getElementById('calendarGrid');
        calendarGrid.innerHTML = '';
        const month = viewDate.getMonth();
        const year = viewDate.getFullYear();

        document.getElementById('monthTitle').textContent = viewDate.toLocaleDateString('ru-RU', { month: 'long', year: 'numeric' });

        const weekdays = ['–ü–Ω', '–í—Ç', '–°—Ä', '–ß—Ç', '–ü—Ç', '–°–±', '–í—Å'];
        weekdays.forEach(day => {
            const dayEl = document.createElement('div');
            dayEl.className = 'themed-text-muted text-sm font-bold';
            dayEl.textContent = day;
            calendarGrid.appendChild(dayEl);
        });

        const firstDayOfMonth = new Date(year, month, 1);
        const daysInMonth = new Date(year, month + 1, 0).getDate();
        let startingDay = firstDayOfMonth.getDay() - 1;
        if (startingDay === -1) startingDay = 6;

        for (let i = 0; i < startingDay; i++) {
            calendarGrid.appendChild(document.createElement('div'));
        }

        for (let i = 1; i <= daysInMonth; i++) {
            const date = new Date(year, month, i);
            const cycleDay = getCycleDayForDate(date);
            
            const dayEl = document.createElement('button');
            dayEl.className = 'day-cell w-full aspect-square flex items-center justify-center rounded-full text-sm';
            dayEl.textContent = i;
            
            if (cycleDay) {
                const phase = getPhaseByCycleDay(cycleDay);
                dayEl.classList.add(`day-${phase}`);
                dayEl.onclick = () => showDayInfo(date);
            } else {
                dayEl.classList.add('themed-text-muted', 'opacity-50');
            }
            
            const today = new Date();
            if (date.toDateString() === today.toDateString()) {
                dayEl.style.outline = `2px solid var(--accent-color)`;
            }

            calendarGrid.appendChild(dayEl);
        }
    }
    
    // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤—Ä–µ–º–µ–Ω–Ω–æ–π —à–∫–∞–ª—ã —Ü–∏–∫–ª–∞
    function renderCycleTimeline() {
        const timeline = document.getElementById('cycle-timeline');
        const legend = document.getElementById('cycle-legend');
        timeline.innerHTML = '';
        legend.innerHTML = '';
        
        const { periodLength, cycleLength } = settings;
        const ovulationDay = cycleLength - 14;
        
        const phaseLengths = {
            menstruation: periodLength,
            follicular: (ovulationDay - 1) - periodLength,
            ovulation: 3,
            luteal: (cycleLength - PMS_LENGTH) - (ovulationDay + 1),
            pms: PMS_LENGTH
        };

        const todayCycleDay = getCycleDayForDate(new Date());

        let cumulativeDays = 0;
        for (const phaseKey in phaseLengths) {
            const phase = PHASES[phaseKey];
            const length = phaseLengths[phaseKey];
            if (length <= 0) continue;

            const segment = document.createElement('div');
            const width = (length / cycleLength) * 100;
            segment.style.width = `${width}%`;
            segment.style.backgroundColor = phase.color;

            if (todayCycleDay && todayCycleDay > cumulativeDays && todayCycleDay <= cumulativeDays + length) {
                segment.style.boxShadow = 'inset 0 0 0 2px white';
            }
            timeline.appendChild(segment);
            cumulativeDays += length;

            const legendItem = document.createElement('div');
            legendItem.className = 'flex items-center';
            legendItem.innerHTML = `<div class="w-2 h-2 rounded-full mr-2" style="background-color: ${phase.color};"></div><span class="themed-text">${phase.name}</span>`;
            legend.appendChild(legendItem);
        }
    }

    // –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–∏ –æ –≤—ã–±—Ä–∞–Ω–Ω–æ–º –¥–Ω–µ
    function showDayInfo(date) {
        const cycleDay = getCycleDayForDate(date);
        const titleEl = document.getElementById('selected-date-title');
        const phaseNameEl = document.getElementById('selected-phase-name');
        const recommendationsEl = document.getElementById('recommendations');
        
        titleEl.textContent = date.toLocaleDateString('ru-RU', { day: 'numeric', month: 'long', year: 'numeric' });
        recommendationsEl.innerHTML = '';

        if (!cycleDay) {
            phaseNameEl.textContent = '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –æ —Ü–∏–∫–ª–µ –¥–ª—è —ç—Ç–æ–π –¥–∞—Ç—ã.';
            return;
        }

        const phaseKey = getPhaseByCycleDay(cycleDay);
        const phase = PHASES[phaseKey];
        
        phaseNameEl.innerHTML = `<span class="font-semibold" style="color: var(--accent-color)">${phase.name}</span> ‚Äî <span class="themed-text-muted">${cycleDay}</span> –¥–µ–Ω—å —Ü–∏–∫–ª–∞`;
        
        for (const [key, value] of Object.entries(phase.data)) {
            const item = document.createElement('div');
            item.innerHTML = `
                <h3 class="font-semibold themed-text">${key}</h3>
                <p class="themed-text-muted text-sm">${value}</p>
            `;
            recommendationsEl.appendChild(item);
        }

        applyTheme(phaseKey);
    }
    
    // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–≤–æ–¥–∫–∏ –Ω–∞ —Å–µ–≥–æ–¥–Ω—è
    function updateTodaySummary() {
        const today = new Date();
        document.getElementById('today-date').textContent = today.toLocaleDateString('ru-RU', { weekday: 'long', day: 'numeric', month: 'long' });

        const cycleDay = getCycleDayForDate(today);
        if (cycleDay) {
            const phaseKey = getPhaseByCycleDay(cycleDay);
            const phase = PHASES[phaseKey];
            document.getElementById('today-phase-name').textContent = phase.name;
            document.getElementById('today-cycle-day').textContent = cycleDay;
            applyTheme(phaseKey);
        } else {
            document.getElementById('today-phase-name').textContent = '–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö';
            document.getElementById('today-cycle-day').textContent = '--';
            applyTheme(null);
        }
    }

    // –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ —Ç–µ–º—ã
    function applyTheme(phaseKey) {
        document.body.className = 'p-4 sm:p-6 lg:p-8';
        if (phaseKey && PHASES[phaseKey]) {
            document.body.classList.add(PHASES[phaseKey].theme);
        }
    }
    
    // –ó–∞–ø–æ–ª–Ω–µ–Ω–∏–µ —Ñ–æ—Ä–º—ã –Ω–∞—Å—Ç—Ä–æ–µ–∫
    function populateSettingsForm() {
        document.getElementById('startDate').value = settings.lastPeriodStart;
        document.getElementById('cycleLength').value = settings.cycleLength;
        document.getElementById('periodLength').value = settings.periodLength;
    }

    // –†–µ–Ω–¥–µ—Ä–∏–Ω–≥ –≤—Å–µ—Ö —ç–ª–µ–º–µ–Ω—Ç–æ–≤
    function renderAll() {
        updateTodaySummary();
        renderCalendar();
        renderCycleTimeline();
    }
    
    // –î–æ–±–∞–≤–ª–µ–Ω–∏–µ —Å–ª—É—à–∞—Ç–µ–ª–µ–π —Å–æ–±—ã—Ç–∏–π
    document.getElementById('saveSettingsBtn').addEventListener('click', saveSettings);

    document.getElementById('prevMonth').onclick = () => {
        viewDate.setMonth(viewDate.getMonth() - 1);
        renderCalendar();
    };

    document.getElementById('nextMonth').onclick = () => {
        viewDate.setMonth(viewDate.getMonth() + 1);
        renderCalendar();
    };

    // –ù–∞—á–∞–ª—å–Ω–∞—è –∑–∞–≥—Ä—É–∑–∫–∞
    populateSettingsForm();
    renderAll();
    showDayInfo(new Date());
});
</script>
</body>
</html>
